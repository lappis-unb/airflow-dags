version: 2
models:
  - name: users
    description: "A table containing user information, including unique identifiers for each user."
    columns:
      - name: user_id
        description: "The unique identifier for each user."
        tests:
          - unique
          - not_null
          - column_completeness_test_source:
              source_name: bronze
              source_table: decidim_users
              origin_column: id

  - name: participatory_processes
    description: "A table containing data on participatory processes, including unique identifiers for each process."
    columns:
      - name: process_id
        description: "The unique identifier for each participatory process."
        tests:
          - unique
          - not_null
          - column_completeness_test_source:
              source_name: bronze
              source_table: decidim_participatory_processes
              origin_column: id

  - name: proposals
    description: "A table containing data on proposals within participatory processes."
    columns:
      - name: proposal_id
        description: "The unique identifier for each proposal."
        tests:
          - unique
          - not_null
          - column_completeness_test_source:
              source_name: bronze
              source_table: decidim_proposals_proposals
              origin_column: id
      - name: process_id
        description: "The identifier linking the proposal to its parent participatory process."
        tests:
          - not_null
          - referential_integrity_test:
              parent_model: participatory_processes
              parent_column: process_id
      - name: user_id
        description: "The identifier linking the proposal to the user who created it."
        tests:
          - not_null
          - referential_integrity_test:
              parent_model: users
              parent_column: user_id

  - name: comments
    description: "A table containing data on comments within participatory processes."
    columns:
      - name: comment_id
        description: "The unique identifier for each comment."
        tests:
          - unique
          - not_null
          - column_completeness_test_source:
              source_name: bronze
              source_table: decidim_comments_comments
              origin_column: id
              origin_filter: o.decidim_participatory_space_type = 'Decidim::ParticipatoryProcess'
      - name: commented_component_id
        description: "The identifier linking the comment to its parent component (proposal or comment)."
        tests:
          - not_null
          - referential_integrity_test:
              parent_model: proposals
              parent_column: proposal_id
              filter: component_type = 'proposal'
          - referential_integrity_test:
              parent_model: comments
              parent_column: comment_id
              filter: component_type = 'comment'
      - name: user_id
        description: "The identifier linking the comment to the user who created it."
        tests:
          - not_null
          - referential_integrity_test:
              parent_model: users
              parent_column: user_id

  - name: votes
    description: "A table containing data on votes within participatory processes."
    columns:
      - name: original_vote_id
        description: "The identifier linking the vote to its original record in the source system."
        tests:
          - column_completeness_test_source:
              source_name: bronze
              source_table: decidim_proposals_proposal_votes
              origin_column: id
              filter: m.component_type = 'proposal'
          - column_completeness_test_source:
              source_name: bronze
              source_table: decidim_comments_comment_votes
              origin_column: id
              filter: m.component_type = 'comment'
      - name: vote_id
        description: "The unique identifier for each vote."
        tests:
          - unique
          - not_null
      - name: voted_component_id
        description: "The identifier linking the vote to its parent component (proposal or comment)."
        tests:
          - not_null
          - referential_integrity_test:
              parent_model: proposals
              parent_column: proposal_id
              filter: component_type = 'proposal'
          - referential_integrity_test:
              parent_model: comments
              parent_column: comment_id
              filter: component_type = 'comment'
      - name: user_id
        description: "The identifier linking the vote to the user who cast it."
        tests:
          - not_null
          - referential_integrity_test:
              parent_model: users
              parent_column: user_id
  - name: datas
    description: "Tabela de datas com a flag de feriado nacional e suas informações detalhadas."
    columns:
      - name: ano_mes_dia
        description: "Data no formato YYYYMMDD."
        tests:
          - not_null
          - unique
      - name: ano_mes
        description: "Data no formato YYYYMM."
        tests:
          - not_null
      - name: ano
        description: "Ano da data."
        tests:
          - not_null
      - name: descricao_dia_semana
        description: "Descrição textual do dia da semana (ex: Segunda-feira)."
        tests:
          - not_null
      - name: descricao_mes
        description: "Descrição textual do mês (ex: Janeiro)."
        tests:
          - not_null
      - name: numero_mes
        description: "Número do mês no ano (ex: 1 para Janeiro)."
        tests:
          - not_null
      - name: numero_dia_mes
        description: "Número do dia no mês."
        tests:
          - not_null
      - name: numero_dia_semana
        description: "Número do dia na semana."
        tests:
          - not_null
      - name: numero_dia_ano
        description: "Número do dia no ano."
        tests:
          - not_null
      - name: numero_semana_mes
        description: "Número da semana no mês."
        tests:
          - not_null
      - name: final_de_semana
        description: "Flag indicando se a data é um final de semana (1 para sim, 0 para não)."
        tests:
          - not_null
      - name: numero_semana_ano
        description: "Número da semana no ano."
        tests:
          - not_null
      - name: flag_feriado
        description: "Flag indicando se a data é um feriado nacional (1 para sim, 0 para não)."
        tests:
          - not_null
      - name: feriado_nacional
        description: "Nome do feriado nacional, caso seja feriado."
        tests: []